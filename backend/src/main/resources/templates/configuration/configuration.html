<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/default}"
      lang="en">
<head>
    <title>System Configuration</title>
    <link rel="stylesheet" th:href="@{/css/configuration.css}">
    <style>
        /* New Configuration Page Styles */
        .config-header {
            margin-bottom: var(--spacing-xl);
        }
        
        .config-header h2 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-xs);
        }
        
        .config-header p {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
        }
        
        /* Tabs */
        .config-tabs {
            display: flex;
            gap: var(--spacing-lg);
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--spacing-xl);
        }
        
        .config-tab {
            padding: var(--spacing-md) 0;
            background: none;
            border: none;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            cursor: pointer;
            position: relative;
            transition: all var(--transition-fast);
        }
        
        .config-tab:hover {
            color: var(--color-primary);
        }
        
        .config-tab.active {
            color: var(--color-primary);
        }
        
        .config-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-primary);
        }
        
        /* Section Header */
        .config-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }
        
        .config-section-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
        }
        
        .add-new-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: transparent;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .add-new-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: var(--color-primary-lighter);
        }
        
        /* Item Cards Grid */
        .config-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-md);
        }
        
        .config-item-card {
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            transition: all var(--transition-fast);
            cursor: pointer;
        }
        
        .config-item-card:hover {
            border-color: var(--color-primary-light);
            box-shadow: var(--shadow-md);
        }
        
        .config-item-icon {
            width: 48px;
            height: 48px;
            background: var(--color-primary-lighter);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .config-item-content {
            flex: 1;
            min-width: 0;
        }
        
        .config-item-name {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: 2px;
        }
        
        .config-item-description {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .config-item-actions {
            display: flex;
            gap: var(--spacing-xs);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        
        .config-item-card:hover .config-item-actions {
            opacity: 1;
        }
        
        .config-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: var(--radius-sm);
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            color: var(--color-text-secondary);
        }
        
        .config-action-btn:hover {
            background: var(--color-gray-100);
        }
        
        .config-action-btn.delete:hover {
            background: var(--color-error-light);
            color: var(--color-error);
        }
        
        /* Empty State */
        .config-empty-state {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--color-text-secondary);
        }
        
        .config-empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.5;
        }
        
        /* Loading State */
        .config-loading {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--color-text-secondary);
        }
        
        /* Tab Content */
        .config-tab-content {
            display: none;
        }
        
        .config-tab-content.active {
            display: block;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .config-tabs {
                gap: var(--spacing-md);
                overflow-x: auto;
                padding-bottom: var(--spacing-sm);
            }
            
            .config-tab {
                white-space: nowrap;
            }
            
            .config-cards-grid {
                grid-template-columns: 1fr;
            }
            
            .config-item-actions {
                opacity: 1;
            }
            
            .config-section-header {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-md);
            }
            
            .add-new-btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <!-- Header -->
    <div class="config-header">
        <h2>Data Management</h2>
        <p>Configure the dropdown options available to veterinarians in the reporting app.</p>
    </div>
    
    <!-- Tabs -->
    <div class="config-tabs">
        <button class="config-tab active" data-tab="animal-types">Animal Types</button>
        <button class="config-tab" data-tab="farm-types">Farm Types</button>
        <button class="config-tab" data-tab="diseases">Disease Types</button>
    </div>
    
    <!-- Animal Types Tab Content -->
    <div id="animal-types-content" class="config-tab-content active">
        <div class="config-section-header">
            <h3 class="config-section-title">Registered Species</h3>
            <button class="add-new-btn" id="add-animal-type-btn">
                <span>+</span> Add New
            </button>
        </div>
        <div class="config-cards-grid" id="animal-types-cards">
            <div class="config-loading">Loading animal types...</div>
        </div>
    </div>
    
    <!-- Farm Types Tab Content -->
    <div id="farm-types-content" class="config-tab-content">
        <div class="config-section-header">
            <h3 class="config-section-title">Farm Categories</h3>
            <button class="add-new-btn" id="add-farm-type-btn">
                <span>+</span> Add New
            </button>
        </div>
        <div class="config-cards-grid" id="farm-types-cards">
            <div class="config-loading">Loading farm types...</div>
        </div>
    </div>
    
    <!-- Diseases Tab Content -->
    <div id="diseases-content" class="config-tab-content">
        <div class="config-section-header">
            <h3 class="config-section-title">Disease Registry</h3>
            <button class="add-new-btn" id="add-disease-btn">
                <span>+</span> Add New
            </button>
        </div>
        <div class="config-cards-grid" id="diseases-cards">
            <div class="config-loading">Loading diseases...</div>
        </div>
    </div>

    <script th:src="@{/js/custom-select.js}"></script>
    <script th:src="@{/js/configuration.js}"></script>
</div>

<!-- Modals Portal - Rendered outside dashboard container for proper stacking -->
<div layout:fragment="modals">
    <!-- Farm Type Modal -->
    <div id="farm-type-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 id="farm-type-modal-title">Add Farm Type</h3>
                <button class="modal-close" data-modal="farm-type-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="farm-type-form">
                    <input type="hidden" id="farm-type-id" name="id">
                    
                    <div class="form-group">
                        <label for="farm-type-name" class="form-label required">Type Name</label>
                        <input type="text" id="farm-type-name" name="typeName" class="form-input" 
                               required maxlength="100" placeholder="e.g., Dairy Farm">
                        <span class="error-message" id="farm-type-name-error"></span>
                    </div>

                    <div class="form-group">
                        <label for="farm-type-description" class="form-label">Description</label>
                        <textarea id="farm-type-description" name="description" class="form-textarea" 
                                  rows="4" maxlength="500" 
                                  placeholder="Brief description of this farm type"></textarea>
                        <span class="error-message" id="farm-type-description-error"></span>
                    </div>

                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" id="farm-type-active" name="isActive" checked>
                            <span>Active</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="farm-type-modal">Cancel</button>
                <button type="submit" form="farm-type-form" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Animal Type Modal -->
    <div id="animal-type-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 id="animal-type-modal-title">Add Animal Type</h3>
                <button class="modal-close" data-modal="animal-type-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="animal-type-form">
                    <input type="hidden" id="animal-type-id" name="id">
                    
                    <div class="form-group">
                        <label for="animal-type-name" class="form-label required">Type Name</label>
                        <input type="text" id="animal-type-name" name="typeName" class="form-input" 
                               required maxlength="100" placeholder="e.g., Dairy Cattle">
                        <span class="error-message" id="animal-type-name-error"></span>
                    </div>

                    <div class="form-group">
                        <label for="animal-type-description" class="form-label">Description</label>
                        <textarea id="animal-type-description" name="description" class="form-textarea" 
                                  rows="4" maxlength="500" 
                                  placeholder="Brief description of this animal type"></textarea>
                        <span class="error-message" id="animal-type-description-error"></span>
                    </div>

                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" id="animal-type-active" name="isActive" checked>
                            <span>Active</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="animal-type-modal">Cancel</button>
                <button type="submit" form="animal-type-form" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Disease Modal -->
    <div id="disease-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 560px;">
            <div class="modal-header">
                <h3 id="disease-modal-title">Add Disease</h3>
                <button class="modal-close" data-modal="disease-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="disease-form">
                    <input type="hidden" id="disease-id" name="id">
                    
                    <div class="form-group">
                        <label for="disease-name" class="form-label required">Disease Name</label>
                        <input type="text" id="disease-name" name="diseaseName" class="form-input" 
                               required maxlength="100" placeholder="e.g., Foot and Mouth Disease">
                        <span class="error-message" id="disease-name-error"></span>
                    </div>

                    <div class="form-group">
                        <label for="disease-code" class="form-label">Disease Code</label>
                        <input type="text" id="disease-code" name="diseaseCode" class="form-input" 
                               maxlength="20" placeholder="e.g., FMD-001">
                        <span class="error-message" id="disease-code-error"></span>
                    </div>

                    <div class="form-group">
                        <label for="disease-animal-type" class="form-label required">Animal Type</label>
                        <select id="disease-animal-type" name="animalTypeId" class="form-select" required>
                            <option value="">Select animal type...</option>
                            <!-- Options will be loaded via AJAX -->
                        </select>
                        <span class="error-message" id="disease-animal-type-error"></span>
                    </div>

                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label for="disease-severity" class="form-label required">Severity</label>
                            <select id="disease-severity" name="severity" class="form-select" required>
                                <option value="">Select severity...</option>
                                <option value="LOW">Low</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="HIGH">High</option>
                                <option value="CRITICAL">Critical</option>
                            </select>
                            <span class="error-message" id="disease-severity-error"></span>
                        </div>

                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <label class="form-checkbox">
                                <input type="checkbox" id="disease-notifiable" name="isNotifiable">
                                <span>Notifiable Disease</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="disease-description" class="form-label">Description</label>
                        <textarea id="disease-description" name="description" class="form-textarea" 
                                  rows="3" maxlength="1000" 
                                  placeholder="Brief description of this disease"></textarea>
                        <span class="error-message" id="disease-description-error"></span>
                    </div>

                    <div class="form-group">
                        <label for="disease-symptoms" class="form-label">Symptoms</label>
                        <textarea id="disease-symptoms" name="symptoms" class="form-textarea" 
                                  rows="2" maxlength="1000" 
                                  placeholder="Common symptoms"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="disease-treatment" class="form-label">Treatment</label>
                        <textarea id="disease-treatment" name="treatment" class="form-textarea" 
                                  rows="2" maxlength="1000" 
                                  placeholder="Treatment recommendations"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" id="disease-active" name="isActive" checked>
                            <span>Active</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="disease-modal">Cancel</button>
                <button type="submit" form="disease-form" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Delete</h3>
                <button class="modal-close" data-modal="delete-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="delete-message">Are you sure you want to delete this item?</p>
                <p id="delete-warning" class="warning-text" style="display: none;">
                    ⚠️ This item is currently in use and cannot be deleted.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-modal="delete-modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#059669">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">Animal Disease Reporting System</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" th:href="@{/css/variables.css}">
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/button.css}">
    <link rel="stylesheet" th:href="@{/css/form.css}">
    <link rel="stylesheet" th:href="@{/css/table.css}">
    <link rel="stylesheet" th:href="@{/css/modal.css}">
    <link rel="stylesheet" th:href="@{/css/responsive.css}">
    
    <!-- Page-specific CSS and other head content -->
    <th:block layout:fragment="head">
        <!-- Additional head content will be inserted here -->
    </th:block>
</head>
<body>
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar" id="dashboard-sidebar">
            <div class="dashboard-header">
                <div class="dashboard-logo">
                    <div class="dashboard-logo-icon">üõ°Ô∏è</div>
                    <div class="dashboard-logo-text">
                        <span class="dashboard-logo-name">ADRS</span>
                        <span class="dashboard-logo-subtitle">Admin Console</span>
                    </div>
                </div>
                <!-- Close button for mobile sidebar -->
                <button class="mobile-menu-toggle show-mobile" id="close-sidebar" aria-label="Close menu">
                    <span>‚úï</span>
                </button>
            </div>
            
            <nav class="dashboard-nav" aria-label="Main navigation">
                <ul>
                    <li>
                        <a th:href="@{/dashboard}" 
                           th:classappend="${currentUri == '/dashboard'} ? 'active' : ''">
                            <span class="nav-icon">üìä</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li sec:authorize="hasRole('ADMIN')">
                        <a th:href="@{/users}" 
                           th:classappend="${#strings.startsWith(currentUri, '/users')} ? 'active' : ''">
                            <span class="nav-icon">üë•</span>
                            <span>User Management</span>
                        </a>
                    </li>
                    <li sec:authorize="hasRole('ADMIN')">
                        <a th:href="@{/configuration}" 
                           th:classappend="${#strings.startsWith(currentUri, '/configuration')} ? 'active' : ''">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span>System Data</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="dashboard-user">
                <div class="dashboard-user-info">
                    <div class="dashboard-user-avatar" 
                         th:text="${#strings.substring(#authentication.name, 0, 1).toUpperCase()}">
                        U
                    </div>
                    <div class="dashboard-user-details">
                        <div class="dashboard-user-name" th:text="${#authentication.name}">Username</div>
                        <div class="dashboard-user-role" 
                             th:text="${#strings.replace(#authentication.authorities[0].authority, 'ROLE_', '')}">
                            Role
                        </div>
                    </div>
                </div>
                <form th:action="@{/logout}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="btn btn-outline btn-block btn-sm sidebar-logout-btn">
                        <span>üö™</span>
                        <span>Logout</span>
                    </button>
                </form>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="dashboard-topbar">
                <!-- Mobile menu toggle -->
                <button class="mobile-menu-toggle" id="open-sidebar" aria-label="Open menu">
                    <div class="hamburger-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
                <h1 th:text="${pageTitle} ?: 'Dashboard'">Page Title</h1>
                <!-- Topbar Actions -->
                <div class="dashboard-topbar-actions">
                    <button class="topbar-notification" aria-label="Notifications">
                        üîî
                        <span class="topbar-notification-badge"></span>
                    </button>
                    <form th:action="@{/logout}" method="post" class="hide-mobile">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="topbar-logout-btn">
                            <span>‚Üí</span>
                            <span>Logout</span>
                        </button>
                    </form>
                </div>
            </div>
            
            <div class="dashboard-content">
                <!-- Flash Messages -->
                <div th:if="${successMessage}" class="alert alert-success mb-md" th:text="${successMessage}">
                    Success message
                </div>
                <div th:if="${errorMessage}" class="alert alert-error mb-md" th:text="${errorMessage}">
                    Error message
                </div>
                
                <!-- Page Content -->
                <div layout:fragment="content">
                    <!-- Content will be inserted here -->
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modal Portal - Modals rendered here are outside dashboard container for proper stacking -->
    <div id="modal-portal" layout:fragment="modals">
        <!-- Page-specific modals will be inserted here -->
    </div>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav" id="mobile-bottom-nav" aria-label="Mobile navigation">
        <ul>
            <li>
                <a th:href="@{/dashboard}" 
                   th:classappend="${currentUri == '/dashboard'} ? 'active' : ''">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-label">Dashboard</span>
                </a>
            </li>
            <li sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/users}" 
                   th:classappend="${#strings.startsWith(currentUri, '/users')} ? 'active' : ''">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-label">Users</span>
                </a>
            </li>
            <li sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/configuration}" 
                   th:classappend="${#strings.startsWith(currentUri, '/configuration')} ? 'active' : ''">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-label">Config</span>
                </a>
            </li>
            <li>
                <a href="#" id="mobile-menu-more">
                    <span class="nav-icon">‚ò∞</span>
                    <span class="nav-label">More</span>
                </a>
            </li>
        </ul>
    </nav>
    
    <!-- JavaScript Files -->
    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/js/responsive.js}"></script>
    <div layout:fragment="scripts">
        <!-- Additional scripts will be inserted here -->
    </div>
</body>
</html>

